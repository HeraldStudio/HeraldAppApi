<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>用户反馈</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">

    <!-- Data Tables -->
    <link href="css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
    <link href="css/plugins/dataTables/dataTables.responsive.css" rel="stylesheet">

    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

</head>

<body onload="query(1)">

<div id="wrapper">

    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav" id="side-menu">
                <li>
                    <a href="/"><i class="fa fa-th-large"></i> <span class="nav-label">首页</span> </a>
                </li>
                <li>
                    <a href="log.html"><i class="fa fa-bar-chart-o"></i> <span class="nav-label">可视日志</span></a>
                </li>
                <li>
                    <a href="slideviews.html"><i class="fa fa-picture-o"></i> <span class="nav-label">轮播图管理</span></a>
                </li>
                <li>
                    <a href="#"><i class="fa fa-group"></i> <span class="nav-label">活动信息</span></a>
                </li>
                <li>
                    <a href="#"><i class="fa fa-envelope"></i> <span class="nav-label">用户推送</span></a>
                </li>
                <li>
                    <a href="feedback.html"><i class="fa fa-table"></i> <span class="nav-label">用户反馈</span></a>
                </li>
            </ul>

        </div>
    </nav>

    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
            <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                <div class="navbar-header">
                    <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
                    <form role="search" class="navbar-form-custom" method="post" action="search_results.html">
                        <div class="form-group">
                            <input type="text" placeholder="Search for something..." class="form-control" name="top-search" id="top-search">
                        </div>
                    </form>
                </div>
                <ul class="nav navbar-top-links navbar-right">
                    <li>
                        <span class="m-r-sm text-muted welcome-message">Welcome to INSPINIA+ Admin Theme.</span>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                            <i class="fa fa-envelope"></i>  <span class="label label-warning"></span>
                        </a>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                            <i class="fa fa-bell"></i>  <span class="label label-primary"></span>
                        </a>
                    </li>
                    <li>
                        <a href="logout">
                            <i class="fa fa-sign-out"></i> Log out
                        </a>
                    </li>
                </ul>

            </nav>
        </div>
        <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-up"></i>
                                </a>
                                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                    <i class="fa fa-wrench"></i>
                                </a>
                                <ul class="dropdown-menu dropdown-user">
                                    <li><a href="#">Config option 1</a>
                                    </li>
                                    <li><a href="#">Config option 2</a>
                                    </li>
                                </ul>
                                <a class="close-link">
                                    <i class="fa fa-times"></i>
                                </a>
                            </div>
                        </div>
                        <div class="ibox-content">
                            <div class="col-sm-6">
                                <div class="dataTables_length" id="DataTables_Table_0_length">
                                    <label>
                                        <select name="DataTables_Table_0_length" aria-controls="DataTables_Table_0" class="form-control input-sm" id="select">
                                            <option value="10">10</option>
                                            <option value="25">25</option>
                                            <option value="50">50</option>
                                            <option value="100">100</option>
                                        </select> records per page</label>
                                </div>
                            </div>
                            <table class="table table-striped table-bordered table-hover dataTables-example" >
                                <thead>
                                <tr>
                                    <th>反馈序号</th>
                                    <th>反馈内容</th>
                                    <th>反馈时间</th>
                                    <th>反馈用户</th>
                                    <th>反馈回复</th>
                                </tr>
                                </thead>
                                <tbody id="table">

                                </tbody>
                                <tfoot>
                                </tfoot>
                            </table>
                            <ul class="pagination pagination-centered" id="page"></ul>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            <div>
                <strong>Copyright</strong> Example Company &copy; 2014-2015
            </div>
        </div>

    </div>
</div>



<!-- Mainly scripts -->
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
<script src="js/plugins/jeditable/jquery.jeditable.js"></script>

<!-- Data Tables -->
<script src="js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script src="js/plugins/dataTables/dataTables.responsive.js"></script>

<!-- Custom and plugin javascript -->
<script src="js/inspinia.js"></script>
<script src="js/plugins/pace/pace.min.js"></script>

<!-- Page-Level Scripts -->
<script>
    $("#select").change(function(){
        query(1);
    });
</script>
<script  type="text/javascript">
    function query(index) {
        $.ajax({
            type: "post",
            url: "/herald/api/v1/admin/feedback",
            data: {
                askcode: 101,
                items_per_page:$("#select").val(),
                page:index,
            },
            success: function (data) {
                result = eval("(" + data + ")");
                if (result.code === 200) {
                    var content=result.content;
                    var npage=result.now_page;
                    var mpage=result.max_page;
                    var text="";
                    for(i=0;i<content.length;i++){
                        text+="<tr class=\"gradeX\"> <td>"+content[i].id+
                            "</td> <td>"+content[i].text+
                            "</td> <td>"+content[i].date+"</td> <td class=\"center\">"+
                            content[i].user+"</td> <td class=\"center\">";
                        if(content[i].responsive)
                            text+=content[i].responsive+"</td> </tr>";
                        else text+="尚未回复</td> </tr>";
                    }
                    $("#table").html(text);
                    $("#page").children().remove()
                    if(npage != 1)
                        $("#page").html("<li><a href='javascript:void(0)' onclick='query("+(npage-1)+")'>Prev</a></li>");
                    for(i = npage-5 > 0?npage-5:1;i <= (mpage>npage+5?npage+5:mpage);i++){
                        if(i!=npage)
                            $("#page").append(" <li><a href='javascript:void(0)' onclick='query("+i+")'>"+i+"</a></li>");
                        else
                            $("#page").append(" <li class='active'><a href='javascript:void(0)' onclick='query("+i+")'>"+i+"</a></li>");
                    }
                    if(npage != mpage)
                        $("#page").append("<li><a href='javascript:void(0)' onclick='query("+(npage+1)+")'>Next</a></li>");
                }
                else alert(result.content)
            },
            error: function (XHR, textStatus, errorThrown) {
                if(XHR.status==403)
                    alert("请登录！")
                window.location.href = "login.html";
            }
        });
    };
</script>
</body>

</html>

